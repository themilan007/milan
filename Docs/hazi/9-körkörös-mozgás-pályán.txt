// Írj komponenst, ami egy zárt szögletes útvonalon mozgat körbe-körbe egy testet fix beállítható sebességgel!
// Az útvonal pontjait egy Vector3 lista tartalmazza, ami a komponens beállítása.
// Az utolsó és az elsõ pont összekötött
// A pályát rajzold ki gizmóval!
// Ha az útvonalon végigért a test, megy tovább körkörösen

using System.Collections.Generic;
using UnityEngine;

public class PathMoverLoop : MonoBehaviour
{
    // Útvonal
    [SerializeField]
    List<Vector3> path = new List<Vector3>
    {
        new Vector3(1,1,0),
        new Vector3(1,-1,0),
        new Vector3(-1,-1,0),
        new Vector3(-1,1,0),
    };

    // Sebesség
    [SerializeField] float speed = 1f;

    // Elõre halad-e? (A következõ pont a lista következõ eleme vagy elõzõ)
    [SerializeField] bool movingForward = true;

    // Aktuális index (Hol tartunk épp?)
    int currentIndex;


void Start()
    {
        // Kezdõiránytól függõen bepozicionáljuk a testet.
        currentIndex = 0;
        if (path != null && path.Count > 0)
            transform.position = path[currentIndex];
    }

    void Update()
    {
        // Következõ célpont
        int nextIndex = movingForward ? currentIndex + 1 : currentIndex;
        Vector3 nextPoint = path[nextIndex];

        // Move Towards metósus
        Vector3 position = Vector3.MoveTowards(transform.position, nextPoint, speed * Time.deltaTime);
        transform.position = position;

        if (position == nextPoint) // Ha elértem egy ponthoz
        {
            if (movingForward)
            {
                currentIndex++;
                // Túlhaladás lekezelése
                currentIndex %= path.Count;
            }

	    else
            {
                currentIndex--;
                // Túlhaladás lekezelése
                if (nextIndex < 0)
                    nextIndex += path.Count;
            }
        }
    }


    void OnDrawGizmos()
    {
        if (path.Count < 2)
            return;

        for (int i = 0; i < path.Count - 1; i++)
            Gizmos.DrawLine(path[i], path[i + 1]);
        Gizmos.DrawLine(path[path.Count - 1], path[0]);
    }
}